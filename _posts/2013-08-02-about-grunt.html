---
layout: default
title: 关于grunt的一点纠结及疑惑
---
<div class="page_all art_view">
	<h2>{{ page.title }}</h2>
	<p class="gray9 mb10">{{ page.date | date_to_string }}</p>
	<div class="art_content">
		<p>使用grunt构建工具几天后发现的几点问题：</p>
		<p>1. 使用grunt-cmd-concat合并文件，有2种模式，合并cmd模块和非cmd模块。
			对于后者，很简单，直接合并在一起就可以了，但是需要手动写规则，项目大了之后不好维护；
			对于前者，非常智能，直接提取模块依赖并合并成一个文件，整个项目直接跑一遍应该就ok了，
			但是又会导致一个问题：如果一个页面有交叉重复调用的模块，就没办法对这个模块就行缓存了，这样就会出现很多重复的模块，
			当然如果项目中没有这种情况或者很少，也可以忽略。
		</p>
		<p>如果能这样改进就好了：设定一个页面的入口模块，从这个模块开始分析直到整个依赖链，自动过滤重复模块，之前调用过的，后面的合并就自动忽略，这样就完美了。</p>	
		<p>2. 使用grunt-cmd-transport提取模块依赖时，一般要设置一个目录，paths : ['js']，
			这样所有存在js/目录下的模块可以被找到，但是'./project/a'这样在js之外的模块就找不到了，因为我的配置中基址目录就是'js/'，
			所以paths选项必须这样设置，不知道这算不算是一个bug。
		</p>	
		<p>3. 这个问题应该算一个bug。
			使用grunt-contrib-uglify插件压缩代码时，如果要对一个目录下的所有文件进行压缩，并设置了压缩后的文件后缀比如.min.js(ext: '.min.js')，
			当你的文件名中存在'.'时，就会出现错误，比如a.b.js就会变成a.min.js，文件名中第一个'.'后的就会被当做原有后缀给替换了。
			如果你不改后缀的话(ext:'')，还是不会出现这个问题。
		</p>	
	</div>
	
	{%include comment.html%}
</div>
